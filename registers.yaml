# ATI Rage 128 Pro Register Definitions
#
# Reference key:
#   RRG:<page>  - Rage 128 Pro Register Reference Guide (PDF page number)
#   xorg:<file> - xserver-xorg-video-r128 driver source
#   linux:<file> - Linux kernel r128 DRM driver source
#
# Field format:
#   bit: N           - single bit at position N
#   bits: [lo, hi]   - multi-bit field from lo to hi (inclusive)
#   values:          - named constants for field values

groups:
  config:
    name: "Configuration Registers"
    ref: "RRG:20"
  crtc:
    name: "CRTC"
    ref: "RRG:79"
  dac:
    name: "DAC"
    ref: "RRG:141"
  memory_buffer:
    name: "Memory Buffer Control"
    ref: "RRG:93"
  overscan:
    name: "Overscan"
    ref: "RRG:97"
  scratch_pad:
    name: "Scratch Pad"
    ref: "RRG:103"
  gui_dest:
    name: "Destination GUI Registers"
    ref: "RRG:155"
  gui_source:
    name: "Source GUI Registers"
    ref: "RRG:164"
  host_data:
    name: "Host Data Registers"
    ref: "RRG:167"
  scissor:
    name: "Scissor Registers"
    ref: "RRG:173"
  datapath:
    name: "Datapath Registers"
    ref: "RRG:182"
  gui_control:
    name: "GUI Engine Control Registers"
    ref: "RRG:200"
  gui_status:
    name: "GUI Engine Status Registers"
    ref: "RRG:201"
  misc:
    name: "Miscellaneous"
    ref: "RRG:207"

registers:
  # ===========================================================================
  # CRTC Registers
  # ===========================================================================
  CRTC_GEN_CNTL:
    offset: 0x0050
    mode: rw
    group: crtc
    ref: "RRG:80"
    fields:
      CRTC_DBL_SCAN_EN:
        bit: 0
      CRTC_INTERLACE_EN:
        bit: 1
      CRTC_C_SYNC_EN:
        bit: 4
      CRTC_PIX_WIDTH:
        bits: [8, 10]
        values:
          4BPP: 1
          8BPP: 2
          15BPP: 3
          16BPP: 4
          24BPP: 5
          32BPP: 6
      CRTC_CUR_EN:
        bit: 16
      CRTC_CUR_MODE:
        bits: [17, 19]
        values:
          64X64_MONO: 0
      CRTC_EXT_DISP_EN:
        bit: 24
      CRTC_EN:
        bit: 25
      CRTC_DISP_REQ_EN_B:
        bit: 26

  CRTC_EXT_CNTL:
    offset: 0x0054
    mode: rw
    group: crtc
    ref: "RRG:82"
    fields:
      CRTC_VGA_XOVERSCAN:
        bit: 0
      VGA_BLINK_RATE:
        bits: [1, 2]
      VGA_ATI_LINEAR:
        bit: 3
      VGA_128KAP_PAGING:
        bit: 4
      VGA_TEXT_132:
        bit: 5
      VGA_XCRT_CNT_EN:
        bit: 6
      CRTC_HSYNC_DIS:
        bit: 8
      CRTC_VSYNC_DIS:
        bit: 9
      CRTC_DISPLAY_DIS:
        bit: 10
      CRTC_SYNC_TRISTATE:
        bit: 11
      CRTC_HSYNC_TRISTATE:
        bit: 12
      CRTC_VSYNC_TRISTATE:
        bit: 13
      CRTC_CRT_ON:
        bit: 15
      VGA_CUR_B_TEST:
        bit: 17
      VGA_PACK_DIS:
        bit: 18
      VGA_MEM_PS_EN:
        bit: 19
      VGA_READ_PREFETCH_DIS:
        bit: 20
      DFIFO_EXTSENSE:
        bit: 21
      FP_OUT_EN:
        bit: 22
      FP_ACTIVE:
        bit: 23
      VCRTC_IDX_MASTER:
        bits: [24, 30]

  CRTC_H_TOTAL_DISP:
    offset: 0x0200
    mode: rw
    group: crtc
    ref: "RRG:79"
    fields:
      CRTC_H_TOTAL:
        bits: [0, 8]
      CRTC_H_DISP:
        bits: [16, 23]

  CRTC_H_SYNC_STRT_WID:
    offset: 0x0204
    mode: rw
    group: crtc
    ref: "RRG:79"
    fields:
      CRTC_H_SYNC_STRT_PIX:
        bits: [0, 2]
      CRTC_H_SYNC_STRT_CHAR:
        bits: [3, 11]
      CRTC_H_SYNC_WID:
        bits: [16, 21]
      CRTC_H_SYNC_POL:
        bit: 23

  CRTC_V_TOTAL_DISP:
    offset: 0x0208
    mode: rw
    group: crtc
    ref: "RRG:79"
    fields:
      CRTC_V_TOTAL:
        bits: [0, 10]
      CRTC_V_DISP:
        bits: [16, 26]

  CRTC_V_SYNC_STRT_WID:
    offset: 0x020c
    mode: rw
    group: crtc
    ref: "RRG:80"
    fields:
      CRTC_V_SYNC_STRT:
        bits: [0, 10]
      CRTC_V_SYNC_WID:
        bits: [16, 20]
      CRTC_V_SYNC_POL:
        bit: 23

  CRTC_OFFSET:
    offset: 0x0224
    mode: rw
    group: crtc

  CRTC_OFFSET_CNTL:
    offset: 0x0228
    mode: rw
    group: crtc

  CRTC_PITCH:
    offset: 0x022c
    mode: rw
    group: crtc

  # ===========================================================================
  # DAC Registers
  # ===========================================================================
  DAC_CNTL:
    offset: 0x0058
    mode: rw
    group: dac
    ref: "RRG:142"
    fields:
      DAC_RANGE_CNTL:
        bits: [0, 1]
      DAC_BLANKING:
        bit: 2
      DAC_CMP_EN:
        bit: 3
      DAC_CMP_OUTPUT:
        bit: 7
      DAC_8BIT_EN:
        bit: 8
      DAC_4BPP_PIX_ORDER:
        bit: 9
      DAC_TVO_EN:
        bit: 10
      DAC_TVO_OVR_EXCL:
        bit: 11
      DAC_TVO_16BPP_DITH_EN:
        bit: 12
      DAC_VGA_ADR_EN:
        bit: 13
      DAC_PDWN:
        bit: 15
      DAC_CRC_EN:
        bit: 19
      DAC_MASK:
        bits: [24, 31]

  PALETTE_INDEX:
    offset: 0x00b0
    mode: rw
    group: dac

  PALETTE_DATA:
    offset: 0x00b4
    mode: rw
    group: dac

  # ===========================================================================
  # Reset & Engine Control Registers
  # ===========================================================================
  GEN_RESET_CNTL:
    offset: 0x00f0
    mode: rw
    group: misc
    ref: "RRG:219"
    fields:
      SOFT_RESET_GUI:
        bit: 0

  PC_NGUI_CTLSTAT:
    offset: 0x0184
    mode: rw
    group: gui_control
    ref: "RRG:253"
    fields:
      PC_FLUSH_GUI:
        bits: [0, 1]
      PC_RI_GUI:
        bits: [2, 3]
      PC_FLUSH_NONGUI:
        bits: [4, 5]
      PC_RI_NONGUI:
        bits: [6, 7]
      PC_PURGE_GUI:
        bit: 8
      PC_PURGE_NONGUI:
        bit: 9
      PC_DIRTY:
        bit: 24
      PC_PURGE_DOPURGE:
        bit: 25
      PC_FLUSH_DOFLUSH:
        bit: 26
      PC_BUSY_INIT:
        bit: 27
      PC_BUSY_FLUSH:
        bit: 28
      PC_BUSY_GUI:
        bit: 29
      PC_BUSY_NGUI:
        bit: 30
      PC_BUSY:
        bit: 31
    aliases:
      PC_FLUSH_ALL:
        bits: [0, 7]
        ref: "linux:drivers/char/drm/r128_drv.h:247"

  # ===========================================================================
  # Interrupt Registers
  # ===========================================================================
  GEN_INT_CNTL:
    offset: 0x0040
    mode: rw
    group: misc
    ref: "RRG:211"
    fields:
      CRTC_VBLANK_INT_EN:
        bit: 0
      CRTC_VLINE_INT_EN:
        bit: 1
      CRTC_VSYNC_INT_EN:
        bit: 2
      SNAPSHOT_INT_EN:
        bit: 3
      FP_DETECT_INT_EN:
        bit: 10
      BUSMASTER_EOL_INT_EN:
        bit: 16
      I2C_INT_EN:
        bit: 17
      MPP_GP_INT_EN:
        bit: 18
      GUI_IDLE_INT_EN:
        bit: 19
      VIPH_INT_EN:
        bit: 24

  # ===========================================================================
  # DDA Registers (Display FIFO Arbitration)
  # ===========================================================================
  DDA_CONFIG:
    offset: 0x02e0
    mode: rw
    group: memory_buffer

  DDA_ON_OFF:
    offset: 0x02e4
    mode: rw
    group: memory_buffer

  # ===========================================================================
  # Overscan Registers
  # ===========================================================================
  OVR_CLR:
    offset: 0x0230
    mode: rw
    group: overscan

  OVR_WID_LEFT_RIGHT:
    offset: 0x0234
    mode: rw
    group: overscan

  OVR_WID_TOP_BOTTOM:
    offset: 0x0238
    mode: rw
    group: overscan

  # ===========================================================================
  # Overlay & Video Registers
  # ===========================================================================
  OV0_SCALE_CNTL:
    offset: 0x0420
    mode: rw
    group: misc

  # ===========================================================================
  # Multimedia Port Processor Registers
  # ===========================================================================
  MPP_TB_CONFIG:
    offset: 0x01c0
    mode: rw
    group: misc

  MPP_GP_CONFIG:
    offset: 0x01c8
    mode: rw
    group: misc

  # ===========================================================================
  # MPEG/DVD Registers
  # ===========================================================================
  SUBPIC_CNTL:
    offset: 0x0540
    mode: rw
    group: misc

  # ===========================================================================
  # VIP & I2C Registers
  # ===========================================================================
  VIPH_CONTROL:
    offset: 0x01d0
    mode: rw
    group: misc

  I2C_CNTL_1:
    offset: 0x0094
    mode: rw
    group: misc

  # ===========================================================================
  # Capture Registers
  # ===========================================================================
  CAP0_TRIG_CNTL:
    offset: 0x0950
    mode: rw
    group: misc

  CAP1_TRIG_CNTL:
    offset: 0x09c0
    mode: rw
    group: misc

  # ===========================================================================
  # PM4/CCE Registers
  # ===========================================================================
  PM4_BUFFER_OFFSET:
    offset: 0x0700
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h"

  PM4_BUFFER_CNTL:
    offset: 0x0704
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h:270"
    fields:
      PM4_BUFFER_CNTL_NOUPDATE:
        bit: 27
      PM4_BUFFER_MODE:
        bits: [28, 31]
        values:
          NONPM4: 0
          192PIO: 1
          192BM: 2
          128PIO_64INDBM: 3
          128BM_64INDBM: 4
          64PIO_128INDBM: 5
          64BM_128INDBM: 6
          64PIO_64VCBM_64INDBM: 7
          64BM_64VCBM_64INDBM: 8
          64PIO_64VCPIO_64INDPIO: 15

  PM4_BUFFER_WM_CNTL:
    offset: 0x0708
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h"

  PM4_BUFFER_DL_RPTR_ADDR:
    offset: 0x070c
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h"

  PM4_BUFFER_DL_RPTR:
    offset: 0x0710
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h"

  PM4_BUFFER_DL_WPTR:
    offset: 0x0714
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h"

  PM4_BUFFER_DL_WPTR_DELAY:
    offset: 0x0718
    mode: rw
    group: misc
    ref: "RRG:238"

  PM4_BUFFER_ADDR:
    offset: 0x07f0
    mode: rw
    group: misc

  PM4_MICRO_CNTL:
    offset: 0x07fc
    mode: rw
    group: misc
    ref: "linux:drivers/char/drm/r128_drv.h:311"
    fields:
      PM4_MICRO_FREERUN:
        bit: 30

  PM4_FIFO_DATA_EVEN:
    offset: 0x1000
    mode: wo
    group: misc

  PM4_FIFO_DATA_ODD:
    offset: 0x1004
    mode: wo
    group: misc

  PM4_MICROCODE_ADDR:
    offset: 0x07d4
    mode: rw
    group: misc
    fields:
      PM4_MICROCODE_ADDR:
        bits: [0, 7]

  PM4_MICROCODE_RADDR:
    offset: 0x07d8
    mode: rw
    group: misc
    description: |
      Read address register for microcode. Write-only (reads return 0). Use this
      to set the address before reading via DATAH/DATAL. Using ADDR instead of
      RADDR before a read corrupts the first instruction read. Writes to RADDR
      also update ADDR (they share the underlying pointer), but RADDR sets a
      "read mode" flag that ADDR does not. Defined in headers but never
      used in driver code.

  PM4_MICROCODE_DATAH:
    offset: 0x07dc
    mode: rw
    group: misc

  PM4_MICROCODE_DATAL:
    offset: 0x07e0
    mode: rw
    group: misc

  PM4_STAT:
    offset: 0x07b8
    mode: ro
    group: gui_status
    ref: "linux:drivers/char/drm/r128_drv.h:300"
    fields:
      PM4_FIFOCNT:
        bits: [0, 11]

  # ===========================================================================
  # GUI Status Registers
  # ===========================================================================
  GUI_STAT:
    offset: 0x1740
    mode: ro
    group: gui_status
    ref: "RRG:201"
    fields:
      GUI_FIFO_CNT:
        bits: [0, 11]
      PM4_BUSY:
        bit: 16
      MICRO_BUSY:
        bit: 17
      FPU_BUSY:
        bit: 18
      VC_BUSY:
        bit: 19
      IDCT_BUSY:
        bit: 20
      ENG_EV_BUSY:
        bit: 21
      SETUP_BUSY:
        bit: 22
      EDGEWALK_BUSY:
        bit: 23
      ADDRESSING_BUSY:
        bit: 24
      ENG_3D_BUSY:
        bit: 25
      ENG_2D_SM_BUSY:
        bit: 26
      ENG_2D_BUSY:
        bit: 27
      GUI_WB_BUSY:
        bit: 28
      CACHE_BUSY:
        bit: 29
      GUI_ACTIVE:
        bit: 31

  # ===========================================================================
  # Datapath / Drawing Engine Registers
  # ===========================================================================
  DP_GUI_MASTER_CNTL:
    offset: 0x146c
    mode: rw
    group: datapath
    ref: "RRG:190"
    fields:
      GMC_SRC_PITCH_OFFSET_CNTL:
        bit: 0
      GMC_DST_PITCH_OFFSET_CNTL:
        bit: 1
      GMC_SRC_CLIPPING:
        bit: 2
      GMC_DST_CLIPPING:
        bit: 3
      GMC_BRUSH_DATATYPE:
        bits: [4, 7]
        values:
          8X8_MONO: 0
          8X8_MONO_TRANS: 1
          8X1_MONO: 2
          8X1_MONO_TRANS: 3
          1X8_MONO: 4
          1X8_MONO_TRANS: 5
          32X1_MONO: 6
          32X1_MONO_TRANS: 7
          32X32_MONO: 8
          32X32_MONO_TRANS: 9
          8X8_COLOR: 10
          8X1_COLOR: 11
          1X8_COLOR: 12
          SOLIDCOLOR: 13
          NONE: 15
      GMC_DST_DATATYPE:
        bits: [8, 11]
        values:
          PSEUDO_COLOR_8: 2
          ARGB_1555: 3
          RGB_565: 4
          RGB_888: 5
          ARGB_8888: 6
          RGB_332: 7
          Y8_GREYSCALE: 8
          RGB_8_GREYSCALE: 9
          YUV_422_VYUY: 11
          YUV_422_YVYU: 12
          AYUV_444_8888: 14
          ARGB_4444: 15
      GMC_SRC_DATATYPE:
        bits: [12, 13]
        values:
          MONO: 0
          MONO_TRANS: 1
          DST_COLOR: 3
      GMC_BYTE_PIX_ORDER:
        bit: 14
      GMC_CONVERSION_TEMP:
        bit: 15
      GMC_ROP3:
        bits: [16, 23]
        values:
          SRCCOPY: 0xcc
      GMC_SRC_SOURCE:
        bits: [24, 26]
        values:
          MEMORY: 2
          HOST_DATA: 3
          HOST_DATA_ALIGNED: 4
      GMC_3D_FCN_EN:
        bit: 27
      GMC_CLR_CMP_CNTL_DIS:
        bit: 28
      GMC_AUX_CLIP_DIS:
        bit: 29
      GMC_WR_MSK_DIS:
        bit: 30
      GMC_LD_BRUSH_Y_X:
        bit: 31

  DP_DATATYPE:
    offset: 0x16c4
    mode: rw
    group: datapath
    ref: "RRG:183"
    fields:
      HOST_BIG_ENDIAN_EN:
        bit: 29

  DP_MIX:
    offset: 0x16c8
    mode: rw
    group: datapath
    ref: "RRG:189"

  DP_WRITE_MSK:
    offset: 0x16cc
    mode: rw
    group: datapath

  DP_CNTL:
    offset: 0x16c0
    mode: rw
    group: datapath
    ref: "RRG:182"
    fields:
      DST_X_LEFT_TO_RIGHT:
        bit: 0
      DST_Y_TOP_TO_BOTTOM:
        bit: 1
      DST_Y_MAJOR:
        bit: 2

  DP_BRUSH_BKGD_CLR:
    offset: 0x15dc
    mode: rw
    group: datapath

  DP_BRUSH_FRGD_CLR:
    offset: 0x1578
    mode: rw
    group: datapath

  DP_SRC_BKGD_CLR:
    offset: 0x15dc
    mode: rw
    group: datapath

  DP_SRC_FRGD_CLR:
    offset: 0x15d8
    mode: rw
    group: datapath

  # ===========================================================================
  # GUI Scratch Registers
  # ===========================================================================
  GUI_SCRATCH_REG0:
    offset: 0x15e0
    mode: rw
    group: scratch_pad

  GUI_SCRATCH_REG1:
    offset: 0x15e4
    mode: rw
    group: scratch_pad

  GUI_SCRATCH_REG2:
    offset: 0x15e8
    mode: rw
    group: scratch_pad

  GUI_SCRATCH_REG3:
    offset: 0x15ec
    mode: rw
    group: scratch_pad

  GUI_SCRATCH_REG4:
    offset: 0x15f0
    mode: rw
    group: scratch_pad

  GUI_SCRATCH_REG5:
    offset: 0x15f4
    mode: rw
    group: scratch_pad

  # ===========================================================================
  # Scissor / Clipping Registers
  # ===========================================================================
  SC_LEFT:
    offset: 0x1640
    mode: rw
    group: scissor

  SC_TOP:
    offset: 0x1648
    mode: rw
    group: scissor

  SC_RIGHT:
    offset: 0x1644
    mode: rw
    group: scissor

  SC_BOTTOM:
    offset: 0x164c
    mode: rw
    group: scissor

  SC_TOP_LEFT:
    offset: 0x16ec
    mode: rw
    group: scissor

  SC_BOTTOM_RIGHT:
    offset: 0x16f0
    mode: rw
    group: scissor

  SRC_SC_BOTTOM:
    offset: 0x165c
    mode: rw
    group: scissor

  SRC_SC_RIGHT:
    offset: 0x1654
    mode: rw
    group: scissor

  SRC_SC_BOTTOM_RIGHT:
    offset: 0x16f4
    mode: rw
    group: scissor

  DEFAULT_SC_BOTTOM_RIGHT:
    offset: 0x16e8
    mode: rw
    group: scissor
    fields:
      DEFAULT_SC_RIGHT:
        bits: [0, 13]
      DEFAULT_SC_BOTTOM:
        bits: [16, 29]

  AUX_SC_CNTL:
    offset: 0x1660
    mode: rw
    group: scissor

  # ===========================================================================
  # Destination Registers
  # ===========================================================================
  DST_OFFSET:
    offset: 0x1404
    mode: rw
    group: gui_dest

  DST_PITCH:
    offset: 0x1408
    mode: rw
    group: gui_dest

  DST_X:
    offset: 0x141c
    mode: rw
    group: gui_dest

  DST_Y:
    offset: 0x1420
    mode: rw
    group: gui_dest

  DST_X_Y:
    offset: 0x1594
    mode: wo
    group: gui_dest

  DST_Y_X:
    offset: 0x1438
    mode: wo
    group: gui_dest

  DST_WIDTH:
    offset: 0x140c
    mode: rw
    group: gui_dest

  DST_HEIGHT:
    offset: 0x1410
    mode: rw
    group: gui_dest

  DST_WIDTH_HEIGHT:
    offset: 0x1598
    mode: rw
    group: gui_dest

  DST_BRES_ERR:
    offset: 0x1628
    mode: rw
    group: gui_dest

  DST_BRES_INC:
    offset: 0x162c
    mode: rw
    group: gui_dest

  DST_BRES_DEC:
    offset: 0x1630
    mode: rw
    group: gui_dest

  # ===========================================================================
  # Source Registers
  # ===========================================================================
  SRC_OFFSET:
    offset: 0x15ac
    mode: rw
    group: gui_source

  SRC_PITCH:
    offset: 0x15b0
    mode: rw
    group: gui_source

  SRC_X:
    offset: 0x141c
    mode: rw
    group: gui_source

  SRC_Y:
    offset: 0x1420
    mode: rw
    group: gui_source

  SRC_X_Y:
    offset: 0x1590
    mode: wo
    group: gui_source

  SRC_Y_X:
    offset: 0x1434
    mode: wo
    group: gui_source

  # ===========================================================================
  # Default Registers
  # ===========================================================================
  DEFAULT_OFFSET:
    offset: 0x16e0
    mode: rw
    group: datapath
    fields:
      DEFAULT_OFFSET:
        bits: [0, 25]

  DEFAULT_PITCH:
    offset: 0x16e4
    mode: rw
    group: datapath
    fields:
      DEFAULT_PITCH:
        bits: [0, 9]
      DEFAULT_TILE:
        bit: 16

  # ===========================================================================
  # Host Data Registers
  # ===========================================================================
  HOST_DATA0:
    offset: 0x17c0
    mode: wo
    group: host_data

  HOST_DATA1:
    offset: 0x17c4
    mode: wo
    group: host_data

  HOST_DATA2:
    offset: 0x17c8
    mode: wo
    group: host_data

  HOST_DATA3:
    offset: 0x17cc
    mode: wo
    group: host_data

  HOST_DATA4:
    offset: 0x17d0
    mode: wo
    group: host_data

  HOST_DATA5:
    offset: 0x17d4
    mode: wo
    group: host_data

  HOST_DATA6:
    offset: 0x17d8
    mode: wo
    group: host_data

  HOST_DATA7:
    offset: 0x17dc
    mode: wo
    group: host_data

  HOST_DATA_LAST:
    offset: 0x17e0
    mode: wo
    group: host_data

  # ===========================================================================
  # 3D Registers
  # ===========================================================================
  SCALE_3D_CNTL:
    offset: 0x1a00
    mode: rw
    group: misc
